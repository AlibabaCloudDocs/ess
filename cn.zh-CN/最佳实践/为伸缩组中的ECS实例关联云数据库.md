# 为伸缩组中的ECS实例关联云数据库

本教程介绍了为伸缩组中的ECS实例关联云数据库的方法，包括将ECS实例和云数据库加入同一个安全组、为伸缩组关联云数据库和将ECS实例加入云数据库白名单。

由于伸缩组内ECS实例可能会被自动释放，建议您将应用数据保存到云数据库。本文主要以控制台为例，为您展示如何为伸缩组中的ECS实例关联云数据库。

## 方式一：将ECS实例和云数据库加入同一个安全组（推荐）

当伸缩组和云数据库的网络类型都为专有网络，并且使用了同一个安全组时，伸缩组的ECS实例可以直接访问云数据库。

**说明：** 此方式下，云数据库的种类不受限，可以是RDS、MongoDB，或者其他类型数据库。

以下操作步骤以RDS MySQL云数据库为例：

-   创建伸缩组和云数据库：
    1.  创建伸缩组，使伸缩组的网络类型为专有网络。具体步骤，请参见[创建伸缩组](/cn.zh-CN/伸缩组/伸缩组/创建伸缩组.md)。
    2.  创建并启用伸缩配置，安全组配置为当前伸缩组专有网络下的安全组。具体步骤，请参见[创建伸缩配置](/cn.zh-CN/伸缩组/组内实例配置信息来源/创建伸缩配置.md)。
    3.  启用伸缩组，具体步骤，请参见[启用伸缩组](/cn.zh-CN/伸缩组/伸缩组/启用伸缩组.md)。
    4.  创建并使用云数据库，使RDS MySQL实例的网络类型和安全组与伸缩组一致。具体步骤，请参见[创建RDS MySQL实例](/cn.zh-CN/RDS MySQL 数据库/快速入门/创建RDS MySQL实例.md)和[设置安全组](/cn.zh-CN/RDS MySQL 数据库/快速入门/设置白名单/设置安全组.md)。

        **说明：** 具体流程，请参见[使用流程](/cn.zh-CN/RDS MySQL 数据库/快速入门/使用流程.md)。

-   修改伸缩组和云数据库（以下步骤主要根据伸缩组配置云数据库的网络类型和安全组）：
    1.  查看伸缩组的网络类型和伸缩配置使用的安全组，请参见[查看伸缩组](/cn.zh-CN/伸缩组/伸缩组/查看伸缩组.md)。

        **说明：** 由于伸缩组不支持修改网络类型，若伸缩组的网络类型为经典网络，您需要重新创建伸缩组。具体步骤，请参见[创建伸缩组](/cn.zh-CN/伸缩组/伸缩组/创建伸缩组.md)。

    2.  查看RDS MySQL实例的网络类型，如果与伸缩组不一致，请根据伸缩组修改。具体步骤，请参见[切换网络类型](/cn.zh-CN/RDS MySQL 数据库/数据库连接/切换网络类型.md)。
    3.  查看RDS MySQL实例使用的安全组，如果与伸缩组不一致，请根据伸缩组修改。具体步骤，请参见[设置安全组](/cn.zh-CN/RDS MySQL 数据库/快速入门/设置白名单/设置安全组.md)。

## 方式二：伸缩组关联数据库

在创建或者修改伸缩组时，您可以关联RDS数据库。关联后，无论伸缩组和云数据库的网络类型是经典网络还是专有网络，伸缩组的ECS实例都可以直接访问云数据库。

**说明：** 此方式下，只支持关联RDS云数据库。

-   创建伸缩组，请参见[创建伸缩组](/cn.zh-CN/伸缩组/伸缩组/创建伸缩组.md)。
-   修改伸缩组，请参见[修改伸缩组](/cn.zh-CN/伸缩组/伸缩组/修改伸缩组.md)。

    **说明：** 如果伸缩组中存在ECS实例，在修改伸缩组时，通过以下方式，将ECS实例添加至关联的RDS云数据库：

    -   控制台：在**修改伸缩组**界面，选中**挂载或卸载RDS实例时，伸缩组现有的实例添加或移出所选RDS实例的白名单**。
    -   [AttachDBInstances](/cn.zh-CN/API参考/伸缩组/AttachDBInstances.md)：配置ForceAttach为true。

## 方式三：伸缩组使用生命周期挂钩和OOS模板，将ECS实例加入云数据库

结合运维编排服务OOS的模板，利用生命周期挂钩挂起伸缩组内的ECS实例，将ECS实例自动加入云数据库白名单。加入白名单后，无论伸缩组和云数据库的网络类型是经典网络还是专有网络，伸缩组的ECS实例都可以直接访问云数据库。

**说明：** 此方式下，只支持云数据库为PolarDB、MongoDB、AnalyticDB类型。

-   [将ECS实例自动加入和移出PolarDB集群白名单](/cn.zh-CN/最佳实践/生命周期挂钩和OOS模板最佳实践/将ECS实例自动加入和移出PolarDB集群白名单.md)
-   [将ECS实例自动加入和移出MongoDB实例白名单](/cn.zh-CN/最佳实践/生命周期挂钩和OOS模板最佳实践/将ECS实例自动加入和移出MongoDB实例白名单.md)
-   [将ECS实例自动加入和移出AnalyticDB集群白名单](/cn.zh-CN/最佳实践/生命周期挂钩和OOS模板最佳实践/将ECS实例自动加入和移出AnalyticDB集群白名单.md)

