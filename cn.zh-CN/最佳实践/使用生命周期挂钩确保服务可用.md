# 使用生命周期挂钩确保服务可用

伸缩组关联负载均衡SLB实例后，在伸缩组中的ECS实例都会自动加入到SLB实例的后端服务器组，处理来自SLB实例分发的客户端请求。本文建议您使用生命周期挂钩，在伸缩活动时，正在加入或移出伸缩组的ECS实例将被挂钩挂起并置于等待状态，为您保留指定时长的操作时间，确保服务可用。

伸缩组已关联SLB实例。具体内容，请参见[在弹性伸缩中使用负载均衡服务](/cn.zh-CN/实例管理/负载均衡实例/在弹性伸缩中使用负载均衡服务.md)。

## 场景一：弹性扩张

在弹性扩张时，如果您未创建生命周期挂钩，扩容出的ECS实例会直接加入伸缩组，包括加入SLB实例的后端服务器组，并且开始对外提供服务。然而，在ECS实例中，为客户端提供服务的应用需要一定的启动时间，如果应用在接收客户端请求时尚未启动，则无法对外提供服务。

建议您为伸缩组创建生命周期挂钩。在ECS实例加入SLB实例的后端服务器组前，生命周期挂钩将扩容的ECS实例挂起。等ECS实例中的应用启动完成，挂钩的超时时间结束后，ECS实例加入到SLB实例的后端服务器组，并对外提供服务。具体步骤，请参见[创建生命周期挂钩](/cn.zh-CN/伸缩组/生命周期挂钩/创建生命周期挂钩.md)。请注意以下配置：

-   **适用的伸缩活动类型**选择为**弹性扩张活动**。
-   **超时时间**建议配置为ECS实例中应用能正常启动的时间。

    **说明：** 如果您想提前结束超时时间，您可以调用API CompleteLifecycleAction。具体内容，请参见[CompleteLifecycleAction](/cn.zh-CN/API参考/生命周期挂钩/CompleteLifecycleAction.md)。

-   **执行策略**选择为**继续**。

生命周期挂钩创建完成后，扩容的ECS实例会先进入**加入挂起中**状态并等待超时时间结束。在挂起期间，ECS实例提供服务的应用完成启动。挂起状态结束后，ECS实例会加入伸缩组，包括加入SLB实例的后端服务器。等ECS实例的状态为**服务中**后，ECS实例对外提供服务。

## 场景二：弹性收缩

在弹性收缩时，如果您未创建生命周期挂钩，缩容的ECS实例会直接移出伸缩组，包括移出SLB实例的后端服务器组，对外停止提供服务。然而，在缩容的ECS实例中，可能存在未处理完成的客户端请求，会导致客户端访问异常。

建议您为已有的伸缩组创建生命周期挂钩。在ECS实例移出SLB实例的后端服务器组后，生命周期挂钩将此ECS实例挂起。等ECS实例处理完毕已接收的请求，挂钩的超时时间结束后，再将此ECS实例移出伸缩组。具体步骤，请参见[创建生命周期挂钩](/cn.zh-CN/伸缩组/生命周期挂钩/创建生命周期挂钩.md)。请注意以下配置：

-   **适用的伸缩活动类型**选择为**弹性收缩活动**。
-   **超时时间**建议配置为所有请求的最长处理时间。

    **说明：** 如果您想提前结束超时时间，您可以调用API CompleteLifecycleAction。具体内容，请参见[CompleteLifecycleAction](/cn.zh-CN/API参考/生命周期挂钩/CompleteLifecycleAction.md)。


创建完成后，缩容的ECS实例会先从SLB实例的后端服务器移出，再进入**移出挂起中**状态并等待超时时间结束。在挂起期间，ECS实例处理完成已接收的请求，且不再接收请求。挂起状态结束后，ECS实例会移出伸缩组。

**相关文档**  


[CreateLifecycleHook](/cn.zh-CN/API参考/生命周期挂钩/CreateLifecycleHook.md)

