# 通过扩缩容策略降低成本 {#concept_ox4_sfh_mgb .concept}

本文介绍如何基于多实例规格和多可用区应用成本优化策略，提高弹性伸缩的成功率，同时降低成本。

## 背景信息 {#section_r5x_j23_mgb .section}

弹性伸缩支持多实例规格，您可以在伸缩配置中指定备选的实例规格。在无法弹出高优先级规格的实例时，弹性伸缩会自动尝试下一优先级规格的实例，直至成功创建实例。多实例规格可以有效应对单个实例规格库存不足的情况，保证伸缩活动可以顺利执行。在业务高峰时，您可能需要争分夺秒地弹出高配实例规格承载业务流量，更关注性能，而不限定于一种特定规格，此时多实例规格尤为实用。

弹性伸缩支持多可用区，您可以在创建伸缩组时指定多台虚拟交换机，在一台虚拟交换机所在的可用区库存不足时，弹性伸缩会自动尝试在其它可用区创建实例，保证伸缩活动可以顺利执行。配置多可用区后，您还可以根据业务部署情况配置对应的扩缩容策略，灵活满足业务需要。多可用区扩缩容策略包括优先级策略、均衡分布策略和成本优化策略，详细信息，请参阅[多可用区扩缩容策略说明](../../../../../cn.zh-CN/用户指南/管理伸缩组的伸缩活动/使用自定义伸缩配置创建伸缩组.md#hxfive)。

由于[抢占式实例](../../../../../cn.zh-CN/产品简介/实例/抢占式实例.md#)受到市场价格限制，竞价失败可能会导致扩容不及时，影响业务运行。此时您可以选择应用成本优化策略，在抢占式实例创建失败时，伸缩组会自动尝试创建相同规格的按量实例，兼顾了成功率和成本，配合多实例规格更会大大提高伸缩活动成功率。应用成本优化策略的伸缩组会按vCPU单价从低到高尝试创建ECS实例，即使您未选用抢占式实例，也能够以最低的价格使用同等规模的ECS实例资源。

## 注意事项 {#section_ebr_k23_mgb .section}

-   多可用区扩缩容策略仅适用于网络类型为专有网络的伸缩组。
-   不支持修改伸缩组的多可用区扩缩容策略。

## 准备工作 {#section_spx_ktn_mgb .section}

在创建应用成本优化策略的伸缩组前，请确保：

-   您已经[创建了专有网络](../../../../../cn.zh-CN/用户指南/使用VPC.md#)。
-   您在专有网络下[创建了多个虚拟交换机](../../../../../cn.zh-CN/用户指南/使用交换机.md#)，且虚拟交换机分布在多个可用区内。

## 操作步骤 {#section_hxj_4f3_mgb .section}

**说明：** 本步骤重点介绍多可用区扩缩容策略相关的选项，如需了解其它伸缩组选项，请参阅[使用自定义伸缩配置创建伸缩组](../../../../../cn.zh-CN/用户指南/管理伸缩组的伸缩活动/使用自定义伸缩配置创建伸缩组.md#)或者[使用实例启动模板创建伸缩组](../../../../../cn.zh-CN/用户指南/管理伸缩组的伸缩活动/使用实例启动模板创建伸缩组.md#)。

1.  登录[弹性伸缩控制台](https://essnew.console.aliyun.com/)。
2.  在创建伸缩组页面中，将**网络类型**配置为**专有网络**，然后选择专有网络下的多个虚拟交换机。

    **说明：** 由于一个虚拟交换机只归属于一个可用区，选择多个虚拟交换机即可以在多个可用区创建ECS实例，合理利用不同可用区的库存。

3.  在创建伸缩组页面中，将**多可用区扩缩容策略**配置为**成本优化策略**。

    ![使用扩缩容策略降低成本-配置网络类型和扩缩容策略](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/106115/154808581137628_zh-CN.png)

4.  根据需要配置其余伸缩组选项。
5.  为伸缩组[创建伸缩配置](../../../../../cn.zh-CN/用户指南/管理伸缩组的实例模板配置/创建伸缩配置.md#)，将**计费方式**配置为**抢占式实例**，然后选择多个实例规格（不超过10个）。

    **说明：** 

    -   建议您按照vCPU、内存、处理器主频、内网带宽或者内网收发包等维度选择多个相近的实例规格。
    -   建议您根据预算设定最高价，如果您使用自动出价，伸缩组会按照抢占式实例的市场价格出价并创建抢占式实例。
    -   I/O优化实例和非I/O优化实例的配置相差较大，即使同时选择也很难增加伸缩成功率。
6.  根据需要配置其余伸缩配置选项。
7.  启用伸缩组。
8.  [创建一条伸缩规则add1](../../../../../cn.zh-CN/用户指南/管理伸缩组的伸缩活动/实现自动伸缩/创建伸缩规则.md#)，效果为向伸缩组添加一台ECS实例。

## 成本控制效果 {#section_bk1_rh3_mgb .section}

假设在[操作步骤](#ol_mtn_rf3_mgb)中，为伸缩组指定了两个可用区下的虚拟交换机：华北1 可用区 B、华北 1 可用区 C，伸缩配置中指定了两种实例规格：ecs.sn1.large、ecs.sn1.xlarge。由于计费方式为抢占式实例，每种实例规格会对应两种单价：抢占式实例vCPU单价、按量付费实例vCPU单价。

**说明：** 本文列出的价格仅用作示例，购买时请以售卖页的实时价格为准。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/106115/154808581137634_zh-CN.png)

组合实例规格和计费方式后，可以得出四种创建实例的方案（vCPU单价从低到高排序）：

|方案编号|实例规格|计费方式|vCPU|市场价格|vCPU单价|
|----|----|----|----|----|------|
|Solution1|ecs.sn1.xlarge|抢占式实例|8|0.158/时|0.01975/时|
|Solution2|ecs.sn1.large|抢占式实例|4|0.088/时|0.022/时|
|Solution3|ecs.sn1.xlarge|按量付费|8|1.393/时|0.174125/时|
|Solution4|ecs.sn1.large|按量付费|4|0.697/时|0.17425/时|

期望动作：当发生扩容伸缩活动时，伸缩组优先按方案 Solution1 创建实例，如果在可用区 B 和可用区 C 下均无法创建出实例，则依次尝试方案 Solution2、Solution3 和 Solution4。

接下来，[执行伸缩规则add1](../../../../../cn.zh-CN/用户指南/管理伸缩组的伸缩活动/实现自动伸缩/执行伸缩规则.md#)触发伸缩活动，向伸缩组添加1台ECS实例。然后，前往弹性伸缩控制台的ECS实例列表页面，单击刚创建的ECS实例，查看计费方式和实例规格，分别为**ecs.sn1.xlarge**和**按量-抢占式实例**，成功降低了成本。

![使用扩缩容策略降低成本-成本优化策略效果](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/106115/154808581137797_zh-CN.png)

